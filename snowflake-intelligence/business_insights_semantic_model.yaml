name: BUSINESS_INSIGHTS_SEMANTIC_MODEL
description: |
  Comprehensive semantic model for analyzing e-commerce business performance across orders, customers, products, order items, support interactions, and reviews. Optimized for revenue analysis, customer segmentation, product performance, operational insights, and customer satisfaction metrics.
tables:
  - name: CUSTOMERS
    synonyms:
      - customer data
      - customer info
    description: Customer profiles with demographic information and segmentation
    base_table:
      database: AUTOMATED_INTELLIGENCE
      schema: RAW
      table: CUSTOMERS
    dimensions:
      - name: CUSTOMER_ID
        synonyms:
          - cust ID
          - customer ID
        description: Unique identifier for each customer
        expr: customer_id
        data_type: NUMBER(38,0)
        unique: true
      - name: CUSTOMER_NAME
        synonyms:
          - customer
          - name
        description: Full name of the customer
        expr: CONCAT(first_name, ' ', last_name)
        data_type: VARCHAR(101)
      - name: CUSTOMER_SEGMENT
        synonyms:
          - customer tier
          - customer type
          - segment
        description: Customer segment (Premium or Standard only)
        expr: customer_segment
        data_type: VARCHAR(20)
        sample_values:
          - Premium
          - Standard
        is_enum: true
      - name: CUSTOMER_STATE
        synonyms:
          - location
          - state
        description: State where the customer is located
        expr: state
        data_type: VARCHAR(2)
      - name: REGISTRATION_DATE
        synonyms:
          - joined date
          - signup date
        description: Date when customer registered
        expr: registration_date
        data_type: DATE
    filters:
      - name: VALID_CUSTOMER_SEGMENTS
        synonyms:
          - active_segments
          - premium_standard_only
          - valid_segments
        description: Use on customers to include only Premium and Standard customer segments, excluding any invalid or null segment values.
        expr: customer_segment IN ('Premium', 'Standard')
    primary_key:
      columns:
        - CUSTOMER_ID
  - name: CUSTOMER_LIFETIME_VALUE
    synonyms:
      - CLV
      - customer value
      - lifetime value
    description: DBT-generated customer lifetime value analysis with RFM segmentation and value tiers
    base_table:
      database: AUTOMATED_INTELLIGENCE
      schema: DBT_ANALYTICS
      table: CUSTOMER_LIFETIME_VALUE
    dimensions:
      - name: CUSTOMER_ID
        synonyms:
          - cust ID
        description: Unique customer identifier
        expr: customer_id
        data_type: NUMBER(38,0)
        unique: true
      - name: CUSTOMER_NAME
        synonyms:
          - name
        description: Full customer name
        expr: customer_name
        data_type: VARCHAR(101)
      - name: CUSTOMER_SEGMENT
        synonyms:
          - segment
        description: Customer segment classification
        expr: customer_segment
        data_type: VARCHAR(20)
        is_enum: true
      - name: CUSTOMER_STATUS
        synonyms:
          - activity status
          - status
        description: Customer activity status (Active, At Risk, Churned)
        expr: customer_status
        data_type: VARCHAR(15)
        sample_values:
          - Active
          - At Risk
          - Churned
        is_enum: true
      - name: SIGNUP_DATE
        synonyms:
          - registration date
        description: Date customer registered
        expr: signup_date
        data_type: DATE
      - name: VALUE_TIER
        synonyms:
          - customer tier
          - tier
        description: Customer value tier (VIP, High-Value, Mid-Value, Low-Value)
        expr: value_tier
        data_type: VARCHAR(12)
        sample_values:
          - VIP
          - High-Value
          - Mid-Value
          - Low-Value
        is_enum: true
    facts:
      - name: AVG_ORDER_VALUE
        synonyms:
          - AOV
        description: Average order value per customer
        expr: avg_order_value
        data_type: NUMBER(28,8)
        access_modifier: public_access
        default_aggregation: avg
      - name: CUSTOMER_LIFESPAN_DAYS
        synonyms:
          - lifespan
        description: Days between first and last order
        expr: customer_lifespan_days
        data_type: NUMBER(9,0)
        access_modifier: public_access
        default_aggregation: avg
      - name: DAYS_SINCE_LAST_ORDER
        synonyms:
          - recency
        description: Days since customer's last order
        expr: days_since_last_order
        data_type: NUMBER(9,0)
        access_modifier: public_access
        default_aggregation: avg
      - name: DAYS_SINCE_SIGNUP
        description: Number of days since customer registered
        expr: days_since_signup
        data_type: NUMBER(9,0)
        access_modifier: public_access
        default_aggregation: avg
      - name: ESTIMATED_ANNUAL_VALUE
        synonyms:
          - projected annual value
        description: Estimated annual revenue from customer
        expr: estimated_annual_value
        data_type: NUMBER(31,8)
        access_modifier: public_access
        default_aggregation: sum
      - name: FREQUENCY_SCORE
        description: RFM frequency score (1-5)
        expr: frequency_score
        data_type: NUMBER(2,0)
        access_modifier: public_access
        default_aggregation: avg
      - name: MONETARY_SCORE
        description: RFM monetary score (1-5)
        expr: monetary_score
        data_type: NUMBER(2,0)
        access_modifier: public_access
        default_aggregation: avg
      - name: ORDERS_PER_MONTH
        synonyms:
          - order frequency
        description: Average orders per month
        expr: orders_per_month
        data_type: NUMBER(26,6)
        access_modifier: public_access
        default_aggregation: avg
      - name: RECENCY_SCORE
        description: RFM recency score (1-5)
        expr: recency_score
        data_type: NUMBER(2,0)
        access_modifier: public_access
        default_aggregation: avg
      - name: RFM_SCORE
        synonyms:
          - RFM
        description: Combined RFM score
        expr: rfm_score
        data_type: NUMBER(10,6)
        access_modifier: public_access
        default_aggregation: avg
      - name: TOTAL_ITEMS_PURCHASED
        description: Total items purchased by customer
        expr: total_items_purchased
        data_type: NUMBER(38,0)
        access_modifier: public_access
        default_aggregation: sum
      - name: TOTAL_ORDERS
        description: Total number of orders placed by customer
        expr: total_orders
        data_type: NUMBER(18,0)
        access_modifier: public_access
        default_aggregation: sum
      - name: TOTAL_REVENUE
        description: Total revenue generated by customer
        expr: total_revenue
        data_type: NUMBER(22,2)
        access_modifier: public_access
        default_aggregation: sum
    filters:
      - name: at_risk_customers
        description: Filters for customers with 'At Risk' status who may be likely to churn or reduce engagement. Use when questions ask about 'at risk customers', 'customers likely to churn', 'retention concerns', 'customers needing attention', or 'churn prevention'. Helps identify customers requiring retention efforts, analyze patterns leading to customer risk, and prioritize customer success interventions.
        expr: customer_status = 'At Risk'
      - name: high_value_customers
        description: Filters for customers in the highest value tiers (High-Value and VIP), representing the most valuable customer segments. Use when questions ask about 'high value customers', 'VIP customers', 'top tier customers', 'premium customers', or 'most valuable customers'. Helps focus analysis on the most profitable customer segments, understand high-value customer behavior, and prioritize retention efforts for key revenue drivers.
        expr: value_tier IN ('High-Value', 'VIP')
    metrics:
      - name: AVERAGE_CUSTOMER_REVENUE
        description: Calculates the average total revenue per customer. Use when questions ask about 'average customer value', 'typical customer revenue', 'mean customer spending', or 'revenue per customer'. Helps analyze customer value distribution, compare customer segments, and evaluate customer acquisition and retention strategies.
        expr: AVG(total_revenue)
        access_modifier: public_access
      - name: AVERAGE_RFM_SCORE
        description: Calculates the average RFM (Recency, Frequency, Monetary) score across customers. Use when questions ask about 'customer engagement level', 'average RFM score', 'customer quality metrics', or 'overall customer behavior score'. Helps evaluate customer base health, identify trends in customer engagement, and measure the effectiveness of customer relationship strategies.
        expr: AVG(rfm_score)
        access_modifier: public_access
      - name: CUSTOMER_COUNT
        description: Counts the total number of customers in the analysis. Use when questions ask about 'how many customers', 'customer count', 'number of customers', or 'customer base size'. Helps measure customer base growth, analyze customer segments by size, and calculate customer-based ratios and percentages.
        expr: COUNT(customer_id)
        access_modifier: public_access
      - name: TOTAL_CUSTOMER_REVENUE
        description: Calculates the sum of total revenue across all customers in the analysis. Use when questions ask about 'total customer revenue', 'aggregate customer value', 'combined customer sales', or 'revenue from customer base'. Helps measure overall customer portfolio value, track customer revenue trends, and evaluate the financial impact of customer segments.
        expr: SUM(total_revenue)
        access_modifier: public_access
    primary_key:
      columns:
        - CUSTOMER_ID
  - name: CUSTOMER_SEGMENTATION
    synonyms:
      - customer segments
      - segmentation
    description: DBT-generated customer segmentation with behavioral analysis and recommended actions
    base_table:
      database: AUTOMATED_INTELLIGENCE
      schema: DBT_ANALYTICS
      table: CUSTOMER_SEGMENTATION
    dimensions:
      - name: BEHAVIORAL_SEGMENT
        synonyms:
          - behavior segment
        description: Behavioral segmentation category
        expr: behavioral_segment
        data_type: VARCHAR(22)
        is_enum: true
      - name: CUSTOMER_ID
        description: Unique customer identifier
        expr: customer_id
        data_type: NUMBER(38,0)
        unique: true
      - name: CUSTOMER_NAME
        description: Full customer name
        expr: customer_name
        data_type: VARCHAR(101)
      - name: CUSTOMER_SEGMENT
        synonyms:
          - segment
        description: Customer segment classification
        expr: customer_segment
        data_type: VARCHAR(20)
        is_enum: true
      - name: CUSTOMER_STATUS
        synonyms:
          - status
        description: Customer activity status
        expr: customer_status
        data_type: VARCHAR(15)
        is_enum: true
      - name: RECOMMENDED_ACTION
        synonyms:
          - action
          - recommendation
        description: Recommended marketing action for this customer
        expr: recommended_action
        data_type: VARCHAR(38)
      - name: SEGMENT_PRIORITY
        synonyms:
          - priority
        description: Priority level for customer engagement (1-3)
        expr: segment_priority
        data_type: NUMBER(1,0)
        sample_values:
          - 1
          - 2
          - 3
      - name: VALUE_TIER
        synonyms:
          - tier
        description: Customer value tier
        expr: value_tier
        data_type: VARCHAR(12)
        is_enum: true
    facts:
      - name: AVG_ORDER_VALUE
        description: Average order value
        expr: avg_order_value
        data_type: NUMBER(28,8)
        access_modifier: public_access
        default_aggregation: avg
      - name: FREQUENCY_SCORE
        description: RFM frequency score
        expr: frequency_score
        data_type: NUMBER(2,0)
        access_modifier: public_access
        default_aggregation: avg
      - name: MONETARY_SCORE
        description: RFM monetary score
        expr: monetary_score
        data_type: NUMBER(2,0)
        access_modifier: public_access
        default_aggregation: avg
      - name: RECENCY_SCORE
        description: RFM recency score
        expr: recency_score
        data_type: NUMBER(2,0)
        access_modifier: public_access
        default_aggregation: avg
      - name: RFM_SCORE
        description: Combined RFM score
        expr: rfm_score
        data_type: NUMBER(10,6)
        access_modifier: public_access
        default_aggregation: avg
      - name: TOTAL_ORDERS
        description: Total orders from customer
        expr: total_orders
        data_type: NUMBER(18,0)
        access_modifier: public_access
        default_aggregation: sum
      - name: TOTAL_REVENUE
        description: Total revenue from customer
        expr: total_revenue
        data_type: NUMBER(22,2)
        access_modifier: public_access
        default_aggregation: sum
    primary_key:
      columns:
        - CUSTOMER_ID
  - name: DAILY_BUSINESS_METRICS
    synonyms:
      - business metrics
      - daily business data
      - daily metrics
    description: Pre-aggregated daily business metrics with automatic refresh
    base_table:
      database: AUTOMATED_INTELLIGENCE
      schema: DYNAMIC_TABLES
      table: DAILY_BUSINESS_METRICS
    dimensions:
      - name: ORDER_DATE_ONLY
        synonyms:
          - date
          - day
          - order date
        description: The calendar date of orders (YYYY-MM-DD format)
        expr: order_date_only
        data_type: DATE
      - name: ORDER_DAY_NAME
        synonyms:
          - day name
          - day of week
          - weekday
        description: The day of the week (Mon, Tue, Wed, Thu, Fri, Sat, Sun)
        expr: order_day_name
        data_type: VARCHAR(3)
        sample_values:
          - Mon
          - Tue
          - Wed
          - Thu
          - Fri
          - Sat
          - Sun
        is_enum: true
      - name: ORDER_MONTH
        synonyms:
          - month
        description: The month of orders (1-12)
        expr: order_month
        data_type: NUMBER(2,0)
        sample_values:
          - 1
          - 2
          - 3
          - 4
          - 5
          - 6
          - 7
          - 8
          - 9
          - 10
          - 11
          - 12
      - name: ORDER_QUARTER
        synonyms:
          - quarter
        description: Quarter of the year (1-4)
        expr: order_quarter
        data_type: NUMBER(2,0)
        sample_values:
          - 1
          - 2
          - 3
          - 4
      - name: ORDER_WEEK
        synonyms:
          - week
          - week number
        description: Week number of the year (1-52)
        expr: order_week
        data_type: NUMBER(2,0)
      - name: ORDER_YEAR
        synonyms:
          - year
        description: The year of orders (e.g., 2024)
        expr: order_year
        data_type: NUMBER(4,0)
        sample_values:
          - 2023
          - 2024
          - 2025
    facts:
      - name: AVG_DISCOUNT_PERCENT
        synonyms:
          - average discount
        description: Average discount percentage applied
        expr: avg_discount_percent
        data_type: NUMBER(23,8)
        access_modifier: public_access
        default_aggregation: avg
      - name: AVG_ORDER_VALUE
        synonyms:
          - AOV
          - average order
        description: Average order value (revenue per order)
        expr: avg_order_value
        data_type: NUMBER(38,8)
        access_modifier: public_access
        default_aggregation: avg
      - name: EXTRA_LARGE_ORDERS_COUNT
        synonyms:
          - extra large orders
          - very big orders
        description: Number of extra large orders
        expr: extra_large_orders
        data_type: NUMBER(18,0)
        access_modifier: public_access
        default_aggregation: sum
      - name: LARGE_ORDERS_COUNT
        synonyms:
          - big orders
          - large orders
        description: Number of large orders
        expr: large_orders
        data_type: NUMBER(18,0)
        access_modifier: public_access
        default_aggregation: sum
      - name: NET_REVENUE
        synonyms:
          - net sales
          - revenue after discounts
        description: Net revenue after applying all discounts
        expr: total_net_revenue
        data_type: NUMBER(35,2)
        access_modifier: public_access
        default_aggregation: sum
      - name: TOTAL_DISCOUNTS
        synonyms:
          - discount amount
          - discounts
        description: Total dollar amount of discounts given
        expr: total_discounts
        data_type: NUMBER(34,2)
        access_modifier: public_access
        default_aggregation: sum
      - name: TOTAL_ORDERS
        synonyms:
          - number of orders
          - order count
          - orders
        description: Total number of orders placed
        expr: total_orders
        data_type: NUMBER(18,0)
        access_modifier: public_access
        default_aggregation: sum
      - name: TOTAL_REVENUE
        synonyms:
          - gross revenue
          - revenue
          - sales
        description: Total revenue from all orders (net after discounts)
        expr: total_net_revenue
        data_type: NUMBER(35,2)
        access_modifier: public_access
        default_aggregation: sum
    filters:
      - name: CURRENT_MONTH_DATA
        synonyms:
          - current_month
          - month_to_date
          - this_month
        description: Use on daily business metrics to include only data from the current calendar month.
        expr: order_year = YEAR(CURRENT_DATE) AND order_month = MONTH(CURRENT_DATE)
      - name: DAYS_WITH_LARGE_ORDERS
        synonyms:
          - has_large_orders
          - high_value_days
          - premium_order_days
        description: Use on daily business metrics to include only days that had at least one large order.
        expr: large_orders > 0
      - name: LAST_30_DAYS
        synonyms:
          - 30_day_window
          - last_month
          - recent_data
        description: Use on daily business metrics to include only data from the last 30 days for recent trend analysis.
        expr: order_date_only >= DATEADD(DAY, -30, CURRENT_DATE)
      - name: LAST_90_DAYS
        synonyms:
          - 90_day_window
          - last_quarter
          - quarterly_data
        description: Use on daily business metrics to include only data from the last 90 days for quarterly trend analysis.
        expr: order_date_only >= DATEADD(DAY, -90, CURRENT_DATE)
      - name: weekend_days
        description: Filters for weekend days (Saturday and Sunday) to analyze weekend business performance. Use when questions ask about 'weekend performance', 'Saturday and Sunday sales', 'weekend vs weekday', 'weekend revenue', or 'weekend patterns'. Helps compare weekend performance against weekdays, understand customer behavior differences between weekend and weekday shopping, and optimize weekend-specific strategies.
        expr: order_day_name IN ('Sat', 'Sun')
    metrics:
      - name: AVG_DAILY_ORDERS
        synonyms:
          - daily_order_average
          - orders_per_day
        description: Average number of orders per day calculated across a time period. Use for comparing order volume patterns between different days of the week, identifying peak ordering days, and understanding daily operational capacity requirements. Essential for staffing decisions and inventory planning based on day-of-week patterns.
        expr: AVG(daily_business_metrics.total_orders)
        access_modifier: public_access
      - name: AVG_DAILY_REVENUE
        synonyms:
          - average daily sales
          - daily revenue average
        description: Average daily revenue calculated across a time period. Use for comparing average performance between different day types (weekdays vs weekends), seasonal periods, or time ranges. Essential for understanding typical daily performance and identifying above/below average revenue days.
        expr: AVG(daily_business_metrics.total_net_revenue)
        access_modifier: public_access
      - name: AVG_ORDER_VALUE_BY_DAY
        synonyms:
          - aov_by_day
          - daily_aov_average
        description: Average order value calculated per day and then averaged across multiple days. Use for understanding how customer spending patterns vary by day of the week, identifying days when customers make larger purchases, and optimizing promotional strategies for specific days. Critical for revenue optimization and day-specific marketing campaigns.
        expr: AVG(daily_business_metrics.avg_order_value)
        access_modifier: public_access
      - name: DISCOUNT_PENETRATION_PERCENTAGE
        description: Calculates the percentage of total gross revenue that was given as discounts. Use when questions ask about 'discount rate', 'how much we discount', 'discount penetration', or 'percentage of sales discounted'. Helps measure promotional impact, evaluate discount strategy effectiveness, and understand the proportion of revenue sacrificed through discounting.
        expr: (SUM(total_discounts) / NULLIF(SUM(total_discounts) + SUM(total_net_revenue), 0)) * 100
        access_modifier: public_access
      - name: DISCOUNT_PENETRATION_RATIO
        description: Calculates the ratio of total discounts to total gross revenue (before converting to percentage). Use when questions need the raw discount penetration ratio for further calculations or when comparing discount rates across periods. Helps analyze discount intensity and promotional strategy impact on revenue.
        expr: SUM(total_discounts) / NULLIF(SUM(total_discounts) + SUM(total_net_revenue), 0)
        access_modifier: public_access
      - name: GROSS_REVENUE_BEFORE_DISCOUNTS
        description: Calculates total gross revenue before any discounts are applied by adding net revenue and total discounts. Use when questions ask about 'gross sales', 'revenue before discounts', 'total sales before promotions', or 'original order values'. Helps measure true sales volume and evaluate the full impact of discount strategies.
        expr: SUM(total_discounts) + SUM(total_net_revenue)
        access_modifier: public_access
      - name: TOTAL_DISCOUNTS_GIVEN
        description: Calculates the total dollar amount of discounts provided to customers. Use when questions ask about 'total discounts', 'discount spending', 'promotional costs', or 'how much we gave in discounts'. Helps measure promotional investment, track discount trends, and evaluate the cost of customer acquisition and retention strategies.
        expr: SUM(total_discounts)
        access_modifier: public_access
      - name: TOTAL_NET_REVENUE_SUM
        description: Calculates the sum of net revenue after all discounts have been applied. Use when questions ask about 'actual revenue', 'net sales', 'revenue after discounts', or 'final sales amount'. Helps measure actual business performance, track real revenue trends, and analyze the bottom-line impact of sales activities.
        expr: SUM(total_net_revenue)
        access_modifier: public_access
  - name: ORDERS
    synonyms:
      - order data
      - transactions
    description: Individual order transactions with pricing and discount details
    base_table:
      database: AUTOMATED_INTELLIGENCE
      schema: RAW
      table: ORDERS
    dimensions:
      - name: CUSTOMER_ID
        synonyms:
          - customer ID
        description: ID of the customer who placed the order
        expr: customer_id
        data_type: NUMBER(38,0)
      - name: DISCOUNT_PERCENTAGE
        synonyms:
          - discount %
          - discount rate
        description: Percentage discount applied to the order (0-100)
        expr: discount_percent
        data_type: NUMBER(5,2)
      - name: ORDER_DATE
        synonyms:
          - date
          - order timestamp
        description: Date and time when order was placed
        expr: order_date
        data_type: TIMESTAMP_NTZ(9)
      - name: ORDER_ID
        synonyms:
          - order ID
        description: Unique identifier for each order
        expr: order_id
        data_type: VARCHAR(36)
        unique: true
      - name: ORDER_STATUS
        synonyms:
          - status
        description: Current status of the order
        expr: order_status
        data_type: VARCHAR(20)
        sample_values:
          - Pending
          - Completed
          - Cancelled
        is_enum: true
    facts:
      - name: APPLIED_DISCOUNT_PERCENT
        description: Returns the discount percentage only for orders that actually received a discount (greater than 0). Use when questions ask about 'actual discounts given', 'discount rates for discounted orders only', or 'average discount for orders with discounts'. Helps analyze discount patterns excluding non-discounted orders and understand discount distribution among discounted transactions.
        expr: CASE WHEN discount_percent > 0 THEN discount_percent END
        data_type: NUMBER(5,2)
        access_modifier: public_access
      - name: DISCOUNT_AMOUNT
        synonyms:
          - discount
        description: Dollar amount of discount applied
        expr: total_amount * (discount_percent / 100)
        data_type: NUMBER(21,10)
        access_modifier: public_access
        default_aggregation: sum
      - name: DISCOUNT_MULTIPLIER
        description: Calculates the multiplier factor to apply discounts (1 minus discount percentage as decimal). Use when questions need to calculate discounted amounts, net values after discount, or revenue calculations that account for discounts. Essential for converting discount percentages into multiplication factors for pricing calculations and revenue analysis.
        expr: 1 - discount_percent / 100
        data_type: NUMBER(12,8)
        access_modifier: public_access
      - name: DISCOUNT_RATE_DECIMAL
        description: Converts discount percentage to decimal format for calculations. Use when questions require discount calculations in decimal form, mathematical operations with discount rates, or when computing discount amounts. Helps standardize discount calculations and enables proper mathematical operations with discount values.
        expr: discount_percent / 100
        data_type: NUMBER(11,8)
        access_modifier: public_access
      - name: DISCOUNTED_ORDER_AMOUNT
        description: Calculates the order amount after applying discount percentage but before adding shipping costs. Use when questions ask about 'order value after discount', 'discounted amount', 'net order value', or 'order total minus discount'. Helps analyze the actual product value customers pay, compare pre-shipping order values across segments, and understand discount impact on order amounts.
        expr: (1 - discount_percent / 100) * total_amount
        data_type: NUMBER(22,10)
        access_modifier: public_access
      - name: FINAL_AMOUNT
        synonyms:
          - amount after discount
          - net amount
        description: Final order amount after discount and shipping
        expr: total_amount * (1 - discount_percent / 100) + shipping_cost
        data_type: NUMBER(23,10)
        access_modifier: public_access
        default_aggregation: sum
      - name: HAS_DISCOUNT_FLAG
        description: Creates a flag (1) for orders that received any discount, null otherwise. Use when questions ask about 'orders with discounts', 'discounted vs non-discounted orders', or need to count/filter orders that received discounts. Helps segment orders by discount status, calculate discount penetration rates, and analyze customer behavior regarding promotional offers.
        expr: CASE WHEN discount_percent > 0 THEN 1 END
        data_type: NUMBER(1,0)
        access_modifier: public_access
      - name: ORDER_TOTAL
        synonyms:
          - order amount
          - total
        description: Total order amount before discount
        expr: total_amount
        data_type: NUMBER(10,2)
        access_modifier: public_access
        default_aggregation: sum
    metrics:
      - name: AVERAGE_ORDER_VALUE_WITH_SHIPPING
        description: Calculates the average order value including shipping costs after discounts are applied. Use when questions ask about 'average order size', 'typical purchase amount', 'AOV with shipping', or 'mean order value'. Helps analyze customer spending patterns, evaluate pricing strategies, and compare order values across customer segments or time periods.
        expr: AVG((1 - discount_percent / 100) * total_amount + shipping_cost)
        access_modifier: public_access
      - name: discount_order_penetration_percentage
        description: Calculates the percentage of orders that received any discount (greater than 0%). Use when questions ask about 'how many orders were discounted', 'percentage of discounted orders', 'discount order penetration', or 'proportion of orders with promotions'. Helps measure promotional reach, understand discount usage patterns, and evaluate the breadth of discount strategy impact.
        expr: 100.0 * COUNT(DISTINCT CASE WHEN discount_percent > 0 THEN order_id END) / COUNT(DISTINCT order_id)
      - name: DISCOUNT_PENETRATION_PERCENTAGE
        description: Calculates the percentage of total gross revenue that was given as discounts. Use when questions ask about 'discount rate', 'how much we discount', 'discount penetration', or 'percentage of sales discounted'. Helps measure promotional impact, evaluate discount strategy effectiveness, and understand the proportion of revenue sacrificed through discounting.
        expr: (SUM((discount_percent / 100) * total_amount) / NULLIF(SUM(total_amount), 0)) * 100
        access_modifier: public_access
      - name: DISCOUNT_PENETRATION_RATIO
        description: Calculates the ratio of total discounts to total gross revenue (before converting to percentage). Use when questions need the raw discount penetration ratio for further calculations or when comparing discount rates across periods. Helps analyze discount intensity and promotional strategy impact on revenue.
        expr: SUM((discount_percent / 100) * total_amount) / NULLIF(SUM(total_amount), 0)
        access_modifier: public_access
      - name: GROSS_REVENUE_BEFORE_DISCOUNTS
        description: Calculates total gross revenue before any discounts are applied. Use when questions ask about 'gross sales', 'revenue before discounts', 'total sales before promotions', or 'original order values'. Helps measure true sales volume and evaluate the full impact of discount strategies.
        expr: SUM(total_amount)
        access_modifier: public_access
      - name: NET_REVENUE_BEFORE_SHIPPING
        description: Calculates total revenue after discounts are applied but before adding shipping costs. Use when questions ask about 'net product revenue', 'revenue after discounts', 'discounted order amounts', or 'product sales value'. Helps measure the actual product value received by the business and analyze discount impact on core product revenue.
        expr: SUM((1 - discount_percent / 100) * total_amount)
        access_modifier: public_access
      - name: ORDER_COUNT
        synonyms:
          - order_volume
          - transaction_count
        description: Total number of distinct orders placed. Use for measuring order volume, calculating conversion rates, and analyzing ordering patterns by customer segment or time period. Essential for understanding transaction frequency and customer behavior patterns.
        expr: COUNT(DISTINCT orders.order_id)
        access_modifier: public_access
      - name: SEGMENT_AOV
        synonyms:
          - average_segment_order
          - segment_order_value
        description: Average order value including shipping costs after discounts, calculated per customer segment. Use for comparing spending patterns between Premium and Standard customers, identifying high-value segments, and optimizing pricing strategies. Critical for understanding customer segment value and purchasing behavior.
        expr: AVG(orders.total_amount * (1 - orders.discount_percent / 100) + orders.shipping_cost)
        access_modifier: public_access
      - name: TOTAL_DISCOUNTS_GIVEN
        description: Calculates the total dollar amount of discounts provided to customers. Use when questions ask about 'total discounts', 'discount spending', 'promotional costs', or 'how much we gave in discounts'. Helps measure promotional investment, track discount trends, and evaluate the cost of customer acquisition and retention strategies.
        expr: SUM((discount_percent / 100) * total_amount)
        access_modifier: public_access
      - name: TOTAL_REVENUE_WITH_SHIPPING
        description: Calculates total revenue including shipping costs after applying discounts across all orders. Use when questions ask about 'total sales', 'complete revenue', 'revenue including shipping', or 'final order amounts'. Helps measure comprehensive business performance including all revenue streams and understand the full financial impact of orders.
        expr: SUM((1 - discount_percent / 100) * total_amount + shipping_cost)
        access_modifier: public_access
    primary_key:
      columns:
        - ORDER_ID
  - name: PRODUCT_AFFINITY
    synonyms:
      - affinity analysis
      - product pairs
      - product recommendations
    description: DBT-generated product affinity analysis showing which products are frequently purchased together
    base_table:
      database: AUTOMATED_INTELLIGENCE
      schema: DBT_ANALYTICS
      table: PRODUCT_AFFINITY
    dimensions:
      - name: AFFINITY_STRENGTH
        synonyms:
          - strength
        description: Affinity strength classification (Very Strong, Strong, Moderate, Weak)
        expr: affinity_strength
        data_type: VARCHAR(11)
        sample_values:
          - Very Strong
          - Strong
          - Moderate
          - Weak
        is_enum: true
      - name: PRODUCT_A_CATEGORY
        description: Category of first product
        expr: product_a_category
        data_type: VARCHAR(50)
      - name: PRODUCT_A_NAME
        synonyms:
          - first product
        description: Name of the first product in the pair
        expr: product_a_name
        data_type: VARCHAR(100)
      - name: PRODUCT_B_CATEGORY
        description: Category of second product
        expr: product_b_category
        data_type: VARCHAR(50)
      - name: PRODUCT_B_NAME
        synonyms:
          - second product
        description: Name of the second product in the pair
        expr: product_b_name
        data_type: VARCHAR(100)
      - name: RECOMMENDATION_PRIORITY
        synonyms:
          - priority
        description: Priority for product recommendations (1-3)
        expr: recommendation_priority
        data_type: NUMBER(1,0)
        sample_values:
          - 1
          - 2
          - 3
    facts:
      - name: CONFIDENCE_A_TO_B
        synonyms:
          - confidence A to B
        description: Probability of buying B when A is purchased
        expr: confidence_a_to_b
        data_type: NUMBER(25,6)
        access_modifier: public_access
        default_aggregation: avg
      - name: CONFIDENCE_B_TO_A
        synonyms:
          - confidence B to A
        description: Probability of buying A when B is purchased
        expr: confidence_b_to_a
        data_type: NUMBER(25,6)
        access_modifier: public_access
        default_aggregation: avg
      - name: LIFT
        description: Lift metric indicating affinity strength
        expr: lift
        data_type: NUMBER(38,6)
        access_modifier: public_access
        default_aggregation: avg
      - name: SUPPORT
        description: Support metric showing overall frequency
        expr: support
        data_type: NUMBER(25,6)
        access_modifier: public_access
        default_aggregation: avg
      - name: TIMES_BOUGHT_TOGETHER
        synonyms:
          - purchase count
        description: Number of times products were purchased together
        expr: times_bought_together
        data_type: NUMBER(18,0)
        access_modifier: public_access
        default_aggregation: sum
    filters:
      - name: strong_product_affinities
        description: Filters for product pairs with strong or very strong affinity relationships, indicating products frequently bought together. Use when questions ask about 'products bought together', 'strong product relationships', 'top product pairs', 'cross-selling opportunities', or 'product recommendations'. Helps identify the most reliable product bundling opportunities, optimize cross-selling strategies, and understand customer purchasing patterns for related products.
        expr: affinity_strength IN ('Strong', 'Very Strong')
  - name: PRODUCT_CATALOG
    synonyms:
      - product data
      - products
    description: Product catalog with winter sports equipment details
    base_table:
      database: AUTOMATED_INTELLIGENCE
      schema: RAW
      table: PRODUCT_CATALOG
    dimensions:
      - name: DESCRIPTION
        synonyms:
          - product description
        description: Detailed product description and features
        expr: description
        data_type: VARCHAR(16777216)
      - name: PRODUCT_CATEGORY
        synonyms:
          - category
          - product type
        description: Category of winter sports product
        expr: product_category
        data_type: VARCHAR(50)
        sample_values:
          - Skis
          - Snowboards
          - Boots
          - Poles
          - Helmets
          - Goggles
      - name: PRODUCT_ID
        synonyms:
          - product ID
        description: Unique identifier for each product
        expr: product_id
        data_type: NUMBER(38,0)
        unique: true
      - name: PRODUCT_NAME
        synonyms:
          - name
          - product
        description: Name of the product
        expr: product_name
        data_type: VARCHAR(100)
    facts:
      - name: PRICE
        synonyms:
          - cost
          - product price
        description: Current price of the product
        expr: price
        data_type: NUMBER(10,2)
        access_modifier: public_access
        default_aggregation: avg
      - name: STOCK_QUANTITY
        synonyms:
          - inventory
          - quantity available
          - stock
        description: Current inventory quantity
        expr: stock_quantity
        data_type: NUMBER(38,0)
        access_modifier: public_access
        default_aggregation: sum
    primary_key:
      columns:
        - PRODUCT_ID
relationships:
  - name: CLV_TO_CUSTOMERS
    left_table: CUSTOMER_LIFETIME_VALUE
    right_table: CUSTOMERS
    relationship_columns:
      - left_column: CUSTOMER_ID
        right_column: CUSTOMER_ID
    relationship_type: one_to_one
  - name: SEGMENTATION_TO_CUSTOMERS
    left_table: CUSTOMER_SEGMENTATION
    right_table: CUSTOMERS
    relationship_columns:
      - left_column: CUSTOMER_ID
        right_column: CUSTOMER_ID
    relationship_type: one_to_one
  - name: ORDERS_TO_CUSTOMERS
    left_table: ORDERS
    right_table: CUSTOMERS
    relationship_columns:
      - left_column: CUSTOMER_ID
        right_column: CUSTOMER_ID
    relationship_type: many_to_one
verified_queries:
  - name: revenue_trend_last_7_days
    question: What's the revenue trend for the last 7 days?
    sql: |
      SELECT 
        order_date_only,
        total_net_revenue as total_revenue,
        total_net_revenue as net_revenue
      FROM automated_intelligence.dynamic_tables.daily_business_metrics
      WHERE order_date_only >= DATEADD('day', -7, CURRENT_DATE())
      ORDER BY order_date_only
    verified_at: 1733702400
    verified_by: Data Team
    use_as_onboarding_question: true
  - name: top_revenue_days_this_month
    question: Which days had the highest revenue this month?
    sql: |
      SELECT 
        order_date_only,
        total_net_revenue as total_revenue
      FROM automated_intelligence.dynamic_tables.daily_business_metrics
      WHERE order_year = YEAR(CURRENT_DATE())
        AND order_month = MONTH(CURRENT_DATE())
      ORDER BY total_net_revenue DESC
      LIMIT 5
    verified_at: 1733702400
    verified_by: Data Team
    use_as_onboarding_question: true
  - name: weekday_vs_weekend_performance
    question: Compare revenue between weekdays and weekends
    sql: |
      SELECT 
        CASE 
          WHEN order_day_name IN ('Sat', 'Sun') THEN 'Weekend'
          ELSE 'Weekday'
        END AS period_type,
        SUM(total_net_revenue) as total_revenue,
        COUNT(*) as num_days,
        AVG(total_net_revenue) as avg_daily_revenue
      FROM automated_intelligence.dynamic_tables.daily_business_metrics
      WHERE order_date_only >= DATEADD('day', -30, CURRENT_DATE())
      GROUP BY period_type
    verified_at: 1733702400
    verified_by: Data Team
  - name: discount_impact_analysis
    question: What's the impact of discounts on revenue?
    sql: |2-
       SELECT (SUM(total_amount * (discount_percent / 100)) / NULLIF(SUM(total_amount), 0)) * 100 as discount_penetration_pct,                            
               SUM(total_amount * (discount_percent / 100)) as total_discounts_given,                                                                      
               SUM(total_amount * (1 - discount_percent / 100)) as net_revenue,                                                                            
               SUM(total_amount) as gross_revenue                                                                                                          
             FROM automated_intelligence.raw.orders                                                                                                        
             WHERE order_date >= DATEADD('day', -30, CURRENT_DATE())                                                                                       
               AND discount_percent IS NOT NULL    
    use_as_onboarding_question: false
    verified_by: Dash Desai
    verified_at: 1767644375
  - name: premium_vs_standard_revenue
    question: Compare revenue between Premium and Standard customer segments
    sql: |
      SELECT 
        c.customer_segment,
        SUM(o.total_amount * (1 - o.discount_percent / 100) + o.shipping_cost) as total_revenue,
        COUNT(DISTINCT o.order_id) as total_orders,
        AVG(o.total_amount * (1 - o.discount_percent / 100) + o.shipping_cost) as avg_order_value
      FROM automated_intelligence.raw.orders o
      JOIN automated_intelligence.raw.customers c ON o.customer_id = c.customer_id
      WHERE o.order_date >= DATEADD('day', -30, CURRENT_DATE())
      GROUP BY c.customer_segment
    verified_at: 1733702400
    verified_by: Data Team
  - name: top_performing_days_of_week
    question: Which day of the week generates the most revenue?
    sql: |
      SELECT 
        order_day_name,
        SUM(total_net_revenue) as total_revenue,
        AVG(total_orders) as avg_orders_per_day,
        AVG(avg_order_value) as avg_order_value
      FROM automated_intelligence.dynamic_tables.daily_business_metrics
      WHERE order_date_only >= DATEADD('day', -90, CURRENT_DATE())
      GROUP BY order_day_name
      ORDER BY total_revenue DESC
    verified_at: 1733702400
    verified_by: Data Team
  - name: large_order_trend
    question: What's the trend in large orders?
    sql: |
      SELECT 
        order_date_only,
        large_orders,
        extra_large_orders,
        total_orders
      FROM automated_intelligence.dynamic_tables.daily_business_metrics
      WHERE order_date_only >= DATEADD('day', -30, CURRENT_DATE())
      ORDER BY order_date_only
    verified_at: 1733702400
    verified_by: Data Team
  - name: order_size_distribution
    question: What is the distribution of order sizes?
    sql: |
      SELECT 
        order_date_only,
        small_orders,
        medium_orders,
        large_orders,
        extra_large_orders,
        total_orders
      FROM automated_intelligence.dynamic_tables.daily_business_metrics
      WHERE order_date_only >= DATEADD('day', -30, CURRENT_DATE())
      ORDER BY order_date_only
    verified_at: 1733702400
    verified_by: Data Team
  - name: customer_value_tier_analysis
    question: Show me the distribution of customers by value tier and their metrics
    sql: |
      SELECT 
        value_tier,
        COUNT(customer_id) as num_customers,
        SUM(total_revenue) as total_revenue,
        AVG(total_revenue) as avg_revenue_per_customer,
        AVG(total_orders) as avg_orders_per_customer,
        AVG(rfm_score) as avg_rfm_score
      FROM automated_intelligence.dbt_analytics.customer_lifetime_value
      GROUP BY value_tier
      ORDER BY 
        CASE value_tier
          WHEN 'VIP' THEN 1
          WHEN 'High-Value' THEN 2
          WHEN 'Mid-Value' THEN 3
          WHEN 'Low-Value' THEN 4
        END
    verified_at: 1735862400
    verified_by: Data Team
  - name: at_risk_customers
    question: Which high-value customers are at risk of churning?
    sql: |
      SELECT 
        customer_name,
        customer_segment,
        value_tier,
        total_revenue,
        total_orders,
        days_since_last_order,
        estimated_annual_value
      FROM automated_intelligence.dbt_analytics.customer_lifetime_value
      WHERE customer_status = 'At Risk'
        AND value_tier IN ('VIP', 'High-Value')
      ORDER BY estimated_annual_value DESC
      LIMIT 20
    verified_at: 1735862400
    verified_by: Data Team
  - name: customer_behavioral_segments
    question: What are the different behavioral segments and their recommended actions?
    sql: |
      SELECT 
        behavioral_segment,
        recommended_action,
        COUNT(customer_id) as num_customers,
        SUM(total_revenue) as segment_revenue,
        AVG(rfm_score) as avg_rfm_score,
        segment_priority
      FROM automated_intelligence.dbt_analytics.customer_segmentation
      GROUP BY behavioral_segment, recommended_action, segment_priority
      ORDER BY segment_priority, num_customers DESC
    verified_at: 1735862400
    verified_by: Data Team
  - name: top_product_pairs
    question: Which products are most frequently bought together?
    sql: |
      SELECT 
        product_a_name,
        product_b_name,
        times_bought_together,
        confidence_a_to_b,
        lift,
        affinity_strength
      FROM automated_intelligence.dbt_analytics.product_affinity
      WHERE affinity_strength IN ('Very Strong', 'Strong')
      ORDER BY times_bought_together DESC
      LIMIT 15
    verified_at: 1735862400
    verified_by: Data Team
  - name: cross_category_recommendations
    question: What cross-category product recommendations have the strongest affinity?
    sql: |
      SELECT 
        product_a_name,
        product_a_category,
        product_b_name,
        product_b_category,
        times_bought_together,
        lift,
        affinity_strength
      FROM automated_intelligence.dbt_analytics.product_affinity
      WHERE product_a_category != product_b_category
        AND recommendation_priority = 1
      ORDER BY lift DESC
      LIMIT 10
    verified_at: 1735862400
    verified_by: Data Team
  - name: Analyze discount impact by calculating total discount amounts, revenue before and after discounts using orders table
    question: Analyze discount impact by calculating total discount amounts, revenue before and after discounts using orders table
    sql: |-
      WITH discount_analysis AS (
        SELECT
          MIN(TO_DATE(order_date)) AS data_start_date,
          MAX(TO_DATE(order_date)) AS data_end_date,
          COUNT(DISTINCT TO_DATE(order_date)) AS total_days_with_data,
          SUM(order_total) AS revenue_before_discounts,
          SUM(discount_amount) AS total_discount_amounts,
          SUM(final_amount - shipping_cost) AS revenue_after_discounts,
          COUNT(order_id) AS total_orders,
          COUNT(
            CASE
              WHEN discount_amount > 0 THEN 1
            END
          ) AS orders_with_discounts
        FROM
          orders
        WHERE
          TO_DATE(order_date) <= CURRENT_DATE
      )
      SELECT
        data_start_date,
        data_end_date,
        total_days_with_data,
        revenue_before_discounts,
        total_discount_amounts,
        revenue_after_discounts,
        revenue_before_discounts - revenue_after_discounts AS discount_impact_amount,
        total_discount_amounts / NULLIF(NULLIF(revenue_before_discounts, 0), 0) AS discount_rate,
        total_orders,
        orders_with_discounts,
        orders_with_discounts / NULLIF(NULLIF(total_orders, 0), 0) AS discount_penetration
      FROM
        discount_analysis
    use_as_onboarding_question: false
    verified_by: Dash Desai
    verified_at: 1767644063
module_custom_instructions:
  sql_generation: |-
    For revenue trend questions, include both total_revenue and net_revenue columns in the output and sort results in chronological order (oldest to newest dates).

    For questions asking for "highest", "lowest", "best", "worst", or similar superlatives, limit results to top 5 by default unless a specific number is requested.

    For questions comparing weekdays vs weekends: 1) Use order_day_name column with values 'Sat' and 'Sun' representing weekends, 2) Default to last 30 days of data unless specified otherwise, 3) Include total revenue, count of days, and average daily revenue for meaningful comparison.

    For questions comparing customer segments or other categorical data, apply a 30-day date filter by default unless a different time period is specified. For comparison questions, include all available categories in the comparison and focus on core metrics (revenue, orders, AOV) without adding percentage calculations or date range columns unless specifically requested.

    For questions analyzing day of the week performance: 1) Apply a 90-day date filter by default, 2) Return all days of the week ranked by the requested metric using order_day_name column, 3) Include total revenue, average orders per day, and average order value in the results.

    For questions analyzing trends in business metrics: 1) Apply a 30-day date filter by default, 2) Include both absolute counts and percentage calculations when analyzing order categories, 3) Sort results chronologically (oldest to newest dates) to show trend progression.

    For questions analyzing business metrics or order patterns: 1) Maintain daily granularity in results rather than aggregating to summary statistics, 2) Do not filter out days with zero values for the metric being analyzed as this skews percentage calculations, 3) Apply the 30-day default date filter, 4) Sort results chronologically to show trends.